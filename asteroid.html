<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Globe + Three.js Objects</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }

        #globeViz {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
<div id="globeViz"></div>

<script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
      }
    }
</script>
<script src="//cdn.jsdelivr.net/npm/globe.gl"></script>
<script type="module">
    import * as THREE from 'three';

    //Constants
    const ETALON = 100;
    const EARTH_CENTER = new THREE.Vector3(0, 0, 0);
    //===========================================================================

    //Globals
    const globe = Globe()
        .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
        .pointsData([{lat: 40, lng: -74, size: 1.5, color: 'red'}])
        (document.getElementById('globeViz'));
    const scene = globe.scene();
    const camera = globe.camera();
    const renderer = globe.renderer();

    let asteroids = [];
    //===========================================================================

    //Classes
    class Asteroid {
        constructor(radius = 10, position = new THREE.Vector3(0, 0, 0), target = new THREE.Vector3(0, 0, 0), speed = 5) {
            this.mesh = new THREE.Mesh(
                new THREE.SphereGeometry(radius, 32, 32),
                new THREE.MeshStandardMaterial({color: 0x888888})
            );

            this.mesh.position.copy(position);
            this.direction = target.clone().sub(position).normalize();
            this.speed = speed;
        }

        animate() {
            this.mesh.position.add(this.direction.clone().multiplyScalar(this.speed));
        }
    }

    //Init
    (function init() {
        camera.position.set(600, 300, 600);

        scene.add(new THREE.AmbientLight(0xffffff, 10));
        const sunLight = new THREE.DirectionalLight(0xffffff, 2);
        sunLight.position.set(5000, 10000, 3000);
        scene.add(sunLight);

        const origin = new THREE.Vector3(0, 0, 0);
        const length = 300;
        const headLength = 20;
        const headWidth = 10;

        const xDir = new THREE.Vector3(1, 0, 0);
        const xArrow = new THREE.ArrowHelper(xDir, origin, length, 0xff0000, headLength, headWidth);
        scene.add(xArrow);

        const yDir = new THREE.Vector3(0, 1, 0);
        const yArrow = new THREE.ArrowHelper(yDir, origin, length, 0x00ff00, headLength, headWidth);
        scene.add(yArrow);

        const zDir = new THREE.Vector3(0, 0, 1);
        const zArrow = new THREE.ArrowHelper(zDir, origin, length, 0x0000ff, headLength, headWidth);
        scene.add(zArrow);

        const gridHelperX = new THREE.GridHelper(ETALON * 100, ETALON);
        gridHelperX.material.opacity = 0.25;
        gridHelperX.material.transparent = true;
        scene.add(gridHelperX);

        const gridHelperY = new THREE.GridHelper(ETALON * 100, ETALON);
        gridHelperY.rotation.x = Math.PI / 2;
        gridHelperY.material.opacity = 0.25;
        gridHelperY.material.transparent = true;
        scene.add(gridHelperY);

        const gridHelperZ = new THREE.GridHelper(ETALON * 100, ETALON);
        gridHelperZ.rotation.z = Math.PI / 2;
        gridHelperZ.material.opacity = 0.25;
        gridHelperZ.material.transparent = true;
        scene.add(gridHelperZ);

        for (let i = 0; i < 100; i++) {
            const pos = new THREE.Vector3(
                (Math.random() - 0.5) * 8000,
                (Math.random() - 0.5) * 8000,
                (Math.random() - 0.5) * 8000
            );

            const radius = 5 + Math.random() * (15 - 5);

            const speed = 1 + Math.random() * (10 - 1);

            const asteroid = new Asteroid(radius, pos, EARTH_CENTER, speed);
            asteroids.push(asteroid);
            scene.add(asteroid.mesh);
        }    })();
    //===========================================================================

    // Main
    (function animate() {
        requestAnimationFrame(animate);
        asteroids.forEach((a)=>a.animate());
    })();
</script>
</body>
</html>
